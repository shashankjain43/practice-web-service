<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.snapdeal.ims.dbmapper.IUserArchiveMapper">
	<resultMap id="resultUser" type="com.snapdeal.ims.dbmapper.entity.User">
		<result property="userId" column="user_id" />
		<result property="sdUserId" column="sd_user_id" />
		<result property="fcUserId" column="fc_user_id" />
		<result property="sdFcUserId" column="sd_fc_user_id" />
		<result property="originatingSrc" column="originating_src" />
		<result property="enabled" column="is_enabled" />
		<result property="emailId" column="email" />
		<result property="password" column="password" />
		<result property="userSetPassword" column="is_user_set_password" />
		<result property="mobileNumber" column="mobile_number" />
		<result property="status" column="status" />
		<result property="googleUser" column="is_google_user" />
		<result property="facebookUser" column="is_facebook_user" />
		<result property="emailVerified" column="is_email_verified" />
		<result property="mobileVerified" column="is_mobile_verified" />
		<result property="firstName" column="first_name" />
		<result property="lastName" column="last_name" />
		<result property="middleName" column="middle_name" />
		<result property="displayName" column="display_name" />
		<result property="gender" column="gender" jdbcType="VARCHAR"
			javaType="com.snapdeal.ims.enums.Gender"
			typeHandler="com.snapdeal.ims.client.dbmapper.entity.typehandler.GenderTypeHandler" />
		<result property="dob" column="dob" jdbcType="DATE" />
		<result property="languagePref" column="language_pref" />
		<result property="purpose" column="purpose" />
		<result property="walletStatus" column="create_wallet_status" />
		<result property="createdTime" column="created_time" />
		<result property="updatedTime" column="updated_time" />
	</resultMap>

	<sql id="insert_column_list_user">
		user_id,
		sd_user_id,
		fc_user_id,
		sd_fc_user_id,
		originating_src,
		is_enabled,
		email,
		password,
		is_user_set_password,
		mobile_number,
		status,
		is_google_user,
		is_facebook_user,
		is_email_verified,
		is_mobile_verified,
		first_name,
		last_name,
		middle_name,
		display_name,
		gender,
		dob,
		language_pref,
		purpose,
		create_wallet_status,
		created_time,
		updated_time
	</sql>

	<insert id="archiveUser" parameterType='String'>
		INSERT INTO user_archive
		(
		<include refid="insert_column_list_user" />
		)
		select
		<include refid="insert_column_list_user" />
		from user where email=#{emailId}
	</insert>

	<delete id='deleteUpgradedUser' parameterType='String'>
		DELETE FROM
		upgrade
		WHERE email=#{emailId}
	</delete>
	
	<delete id='deleteUser' parameterType='String'>
		DELETE FROM user
		WHERE
		email=#{emailId}
	</delete>
	
</mapper>