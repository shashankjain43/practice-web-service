<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.snapdeal.ims.dashboard.dbmapper.IWalletCountDao">
	<select id="retrieveWalletStatus" resultType="int"
		parameterType="com.snapdeal.ims.entity.FilterEntity">
		select count(upgrade.upgrade_status)
		from
		user,upgrade where
		upgrade.email =
		user.email and 
		upgrade.upgrade_status = 'UPGRADE_COMPLETED'
		<if test="status!=null">
		and	user.create_wallet_status = #{status} 
		</if>
		<if test="originating_src!=null">
			and user.originating_src = #{originating_src} 
		</if>
		<if test="upgradeChannel!=null">
			<if test="!upgradeChannel.isEmpty()">
				and upgrade.upgrade_channel in 
				<foreach item="item" open="("  separator="," close = ")" index="index" collection="upgradeChannel">
					  #{item}
				</foreach>
			</if>	
		</if>
		<if test="upgradeSource!=null">
			<if test="!upgradeSource.isEmpty()">
				and upgrade.upgrade_source in
				<foreach item="item" open="(" close = ")" separator="," index="index" collection="upgradeSource">
					 #{item} 
				</foreach>
			</if>
		</if>
	</select>

	<select id="retrieveEmailListForUpgradeFilter" resultType="java.lang.String"
		parameterType="com.snapdeal.ims.entity.FilterEntity">
		select user.email
		from
		user,upgrade where
		upgrade.email =
		user.email and
		user.create_wallet_status = 'FAILED' and
		upgrade.upgrade_status = 'UPGRADE_COMPLETED'
		<if test="originating_src!=null">
			and user.originating_src = #{originating_src}
		</if>
		<if test="upgradeChannel!=null">
			<if test="!upgradeChannel.isEmpty()">
				and upgrade.upgrade_channel in 
				<foreach item="item" open="("  separator="," close = ")" index="index" collection="upgradeChannel">
					  #{item}
				</foreach>
			</if>
		</if>
		<if test="upgradeSource!=null">
			<if test="!upgradeSource.isEmpty()">
				and upgrade.upgrade_source in
				<foreach item="item" open="(" close = ")" separator="," index="index" collection="upgradeSource">
					 #{item} 
				</foreach>
			</if>
		</if>
	</select>
</mapper>
